{"version":3,"file":"ImageView-0ab41af4.js","sources":["../../src/plugins/image/ImageView.vue"],"sourcesContent":["<template lang=\"pug\">\n.image-container(v-if=\"myState.yamlConfig\" :class=\"{'zthumbnail' : thumbnail }\")\n  img.medium-zoom(\n    :src=\"myState.imageData\"\n    :class=\"{'invert-colors' : isDarkMode }\")\n</template>\n\n<script lang=\"ts\">\n'use strict'\n\nimport { defineComponent } from 'vue'\nimport type { PropType } from 'vue'\n\n// import mediumZoom from 'medium-zoom'\nimport readBlob from 'read-blob'\n\nimport globalStore from '@/store'\nimport { ColorScheme, FileSystem, FileSystemConfig, VisualizationPlugin } from '@/Globals'\nimport HTTPFileSystem from '@/js/HTTPFileSystem'\n\nconst MyComponent = defineComponent({\n  name: 'ImageViewPlugin',\n  props: {\n    fileApi: { type: Object as PropType<FileSystem>, required: true },\n    subfolder: { type: String, required: true },\n    yamlConfig: String,\n    thumbnail: Boolean,\n  },\n  data: () => {\n    return {\n      globalState: globalStore.state,\n      myState: {} as any,\n      matsimPngTitles: {\n        'modestats.png': 'Mode statistics',\n        'ph_modestats.png': 'Passenger hours traveled per mode',\n        'pkm_modestats.png': 'Passenger km traveled per mode',\n        'scorestats.png': 'Score statistics',\n        'stopwatch.png': 'Stopwatch: computation time',\n        'traveldistancestatslegs.png': 'Leg travel distance',\n        'traveldistancestatstrips.png': 'Trip travel distance',\n      } as { [id: string]: string },\n    }\n  },\n  computed: {\n    isDarkMode(): boolean {\n      return this.globalState.isDarkMode\n    },\n  },\n  methods: {\n    // this happens if viz is the full page, not a thumbnail on a project page\n    buildRouteFromUrl() {\n      const params = this.$route.params\n      if (!params.project || !params.pathMatch) {\n        console.log('I CANT EVEN: NO PROJECT/PARHMATCH')\n        return\n      }\n\n      // subfolder and config file\n      const sep = 1 + params.pathMatch.lastIndexOf('/')\n      const subfolder = params.pathMatch.substring(0, sep)\n      const config = params.pathMatch.substring(sep)\n\n      this.myState.subfolder = subfolder\n      this.myState.yamlConfig = config\n    },\n\n    async getVizDetails() {\n      try {\n        const blob = await this.myState.fileApi.getFileBlob(\n          this.myState.subfolder + '/' + this.myState.yamlConfig\n        )\n\n        if (!blob) {\n          console.log('no blob! :-(')\n          return\n        }\n\n        const dataUrl = await readBlob.dataurl(blob)\n        this.myState.imageData = dataUrl\n\n        const config = this.yamlConfig as any\n        const newTitle = this.matsimPngTitles[config]\n          ? this.matsimPngTitles[config]\n          : this.yamlConfig\n\n        this.$emit('title', newTitle)\n      } catch (e) {\n        console.error({ e })\n        return null\n      }\n    },\n  },\n  watch: {\n    yamlConfig() {\n      this.myState.yamlConfig = this.yamlConfig\n      this.getVizDetails()\n    },\n\n    subfolder() {\n      this.myState.subfolder = this.subfolder\n      this.getVizDetails()\n    },\n  },\n  mounted() {\n    this.myState = {\n      fileApi: this.fileApi,\n      subfolder: this.subfolder,\n      yamlConfig: this.yamlConfig,\n      thumbnail: this.thumbnail,\n      imageData: '',\n    }\n\n    if (!this.yamlConfig) {\n      this.buildRouteFromUrl()\n    }\n\n    this.getVizDetails()\n  },\n})\n\nexport default MyComponent\n</script>\n\n<style scoped lang=\"scss\">\n@import '@/styles.scss';\n\n.image-container.zthumbnail {\n  max-height: $thumbnailHeight;\n  overflow: hidden;\n}\n\n.medium-zoom {\n  padding: 0.25rem 0.25rem;\n}\n\n// .invert-colors {\n//   filter: invert(100%);\n// }\n</style>\n"],"names":["MyComponent","defineComponent","globalStore","params","sep","subfolder","config","blob","dataUrl","readBlob","newTitle"],"mappings":"yFAoBA,MAAAA,EAAAC,EAAA,CACA,KAAA,kBACA,MAAA,CACA,QAAA,CAAA,KAAA,OAAA,SAAA,EAAA,EACA,UAAA,CAAA,KAAA,OAAA,SAAA,EAAA,EACA,WAAA,OACA,UAAA,OACA,EACA,KAAA,KACA,CACA,YAAAC,EAAA,MACA,QAAA,CAAA,EACA,gBAAA,CACA,gBAAA,kBACA,mBAAA,oCACA,oBAAA,iCACA,iBAAA,mBACA,gBAAA,8BACA,8BAAA,sBACA,+BAAA,sBACA,CAAA,GAGA,SAAA,CACA,YAAA,CACA,OAAA,KAAA,YAAA,UACA,CACA,EACA,QAAA,CAEA,mBAAA,CACA,MAAAC,EAAA,KAAA,OAAA,OACA,GAAA,CAAAA,EAAA,SAAA,CAAAA,EAAA,UAAA,CACA,QAAA,IAAA,mCAAA,EACA,MACA,CAGA,MAAAC,EAAA,EAAAD,EAAA,UAAA,YAAA,GAAA,EACAE,EAAAF,EAAA,UAAA,UAAA,EAAAC,CAAA,EACAE,EAAAH,EAAA,UAAA,UAAAC,CAAA,EAEA,KAAA,QAAA,UAAAC,EACA,KAAA,QAAA,WAAAC,CACA,EAEA,MAAA,eAAA,CACA,GAAA,CACA,MAAAC,EAAA,MAAA,KAAA,QAAA,QAAA,YACA,KAAA,QAAA,UAAA,IAAA,KAAA,QAAA,UAAA,EAGA,GAAA,CAAAA,EAAA,CACA,QAAA,IAAA,cAAA,EACA,MACA,CAEA,MAAAC,EAAA,MAAAC,EAAA,QAAAF,CAAA,EACA,KAAA,QAAA,UAAAC,EAEA,MAAAF,EAAA,KAAA,WACAI,EAAA,KAAA,gBAAAJ,CAAA,EACA,KAAA,gBAAAA,CAAA,EACA,KAAA,WAEA,KAAA,MAAA,QAAAI,CAAA,QACA,EAAA,CACA,eAAA,MAAA,CAAA,CAAA,CAAA,EACA,IACA,CACA,CACA,EACA,MAAA,CACA,YAAA,CACA,KAAA,QAAA,WAAA,KAAA,WACA,KAAA,cAAA,CACA,EAEA,WAAA,CACA,KAAA,QAAA,UAAA,KAAA,UACA,KAAA,cAAA,CACA,CACA,EACA,SAAA,CACA,KAAA,QAAA,CACA,QAAA,KAAA,QACA,UAAA,KAAA,UACA,WAAA,KAAA,WACA,UAAA,KAAA,UACA,UAAA,EAAA,EAGA,KAAA,YACA,KAAA,kBAAA,EAGA,KAAA,cAAA,CACA,CACA,CAAA"}