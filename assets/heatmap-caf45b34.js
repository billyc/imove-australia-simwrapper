import{d,g as m,U as u,B as h,S as r,n as f}from"./index-2c5e1d98.js";import{V as g}from"./VuePlotly-0708e021.js";import{b as p}from"./DashBoard-413cbafb.js";import{t as y}from"./pureFunctionsAny.generated-3fc6f1be.js";import"./index-8048e8dc.js";import"./HTTPFileSystem-f986ffa8.js";import"./TopSheet-f6bbf3c3.js";import"./extends-98964cd2.js";const b=d({name:"HeatmapPanel",components:{VuePlotly:g},props:{fileSystemConfig:{type:Object,required:!0},subfolder:{type:String,required:!0},files:{type:Array,required:!0},config:{type:Object,required:!0},cardTitle:{type:String,required:!0},cardId:String,datamanager:{type:Object,required:!0},zoomed:Boolean},data:()=>({globalState:m.state,dataSet:{},id:"heatmap-"+Math.floor(1e12*Math.random()),YAMLrequirementsHeatmap:{dataset:"",y:"",columns:[]},layout:{margin:{t:8,b:50},font:{color:"#444444",family:u},barmode:"",bargap:.08,xaxis:{autorange:!0,title:""},yaxis:{autorange:!0,title:""},legend:{x:1,xanchor:"right",y:1}},data:[],options:{displaylogo:!1,responsive:!0,modeBarButtonsToRemove:["pan2d","zoom2d","select2d","lasso2d","zoomIn2d","zoomOut2d","autoScale2d","hoverClosestCartesian","hoverCompareCartesian","resetScale2d","toggleSpikelines","resetViewMapbox"],toImageButtonOptions:{format:"png",filename:"heatmap",width:1200,height:800,scale:1}}}),async mounted(){this.updateTheme(),this.checkWarningsAndErrors(),this.dataSet=await this.loadData(),Object.keys(this.dataSet).length&&(this.updateChart(),this.options.toImageButtonOptions.filename=p(this.cardTitle,this.subfolder),this.$emit("dimension-resizer",{id:this.cardId,resizer:this.changeDimensions})),this.$emit("isLoaded")},beforeDestroy(){var t;(t=this.datamanager)==null||t.removeFilterListener(this.config,this.handleFilterChanged)},watch:{zoomed(){this.resizePlot()},"globalState.isDarkMode"(){this.updateTheme()}},methods:{changeDimensions(t){this.layout=Object.assign({},this.layout,t)},resizePlot(){var t=document.getElementsByClassName("spinner-box");if(this.zoomed)for(let e of t)e.clientHeight>0&&(this.layout.height=e.clientHeight);else this.layout.height=300},updateTheme(){const t={paper_bgcolor:h[this.globalState.colorScheme],plot_bgcolor:h[this.globalState.colorScheme],font:{color:this.globalState.isDarkMode?"#cccccc":"#444444"}};this.layout=Object.assign({},this.layout,t)},handleFilterChanged(){if(!this.datamanager)return;const{filteredRows:t}=this.datamanager.getFilteredDataset(this.config);if(!t||!t.length)this.dataSet={allRows:{}};else{const e={},a=Object.keys(t[0]);a.forEach(i=>e[i]={name:i,values:[]}),t.forEach(i=>{a.forEach(o=>e[o].values.push(i[o]))}),this.dataSet={allRows:e}}this.updateChart()},async loadData(){try{this.validateYAML();let t=await this.datamanager.getDataset(this.config);if(!this.config.filters)return t;this.datamanager.addFilterListener(this.config,this.handleFilterChanged);for(const[e,a]of Object.entries(this.config.filters)){const i={dataset:this.config.dataset,column:e,value:a,range:Array.isArray(a)};this.datamanager.setFilter(i)}return{allRows:{}}}catch(t){console.error(""+t)}return{allRows:{}}},validateYAML(){for(const t in this.YAMLrequirementsHeatmap)t in this.config||this.$emit("error",{type:r.ERROR,msg:`YAML file missing required key: ${t}`,desc:"Check this.YAMLrequirementsXY for required keys"})},updateChart(){this.layout.xaxis.title=this.config.xAxisTitle||this.config.xAxisName||"",this.layout.yaxis.title=this.config.yAxisTitle||this.config.yAxisName||"";try{this.config.groupBy?this.updateChartWithGroupBy():this.updateChartSimple()}catch(t){const e=""+t;this.$emit("error",{type:r.ERROR,msg:e,desc:"Add a desription..."})}},updateChartWithGroupBy(){},updateChartSimple(){var t=[],e=[];const a=this.dataSet.allRows||{},i=this.config.columns||this.config.usedCol||[];if(!i.length)return;let o=!0;const n=["y"];for(const s of n)a[this.config[s]]||(this.$store.commit("error",`${this.cardTitle}: "${this.config.dataset}" ${n} column "${s}" missing`),o=!1);if(!o)return;let l=a[this.config.y].values;for(const s of Object.keys(a))i.includes(s)&&t.push(s);let c=0;for(const s of this.config.columns)e[c++]=a[s].values;this.config.flipAxes||(e=y(e)),this.data=[{x:this.config.flipAxes?l:t,y:this.config.flipAxes?t:l,z:e,colorscale:"Viridis",type:"heatmap",automargin:!0}]},checkWarningsAndErrors(){var t=this.cardTitle;t.length==0&&this.$emit("error",{type:r.WARNING,msg:"The plot title is missing!",desc:"Please add a plot title in the .yaml-file (title: 'Example title')"})}}});var x=function(){var e=this,a=e._self._c;return e._self._setupProxy,a("VuePlotly",{staticClass:"myplot",attrs:{data:e.data,layout:e.layout,options:e.options,id:e.id}})},S=[];var _=f(b,x,S,!1,null,"092dbbaa",null,null);const z=_.exports;export{z as default};
//# sourceMappingURL=heatmap-caf45b34.js.map
