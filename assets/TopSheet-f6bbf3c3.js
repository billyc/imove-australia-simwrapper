import{d as r,g as o,n}from"./index-2c5e1d98.js";function c(){return new Worker("/assets/TopSheetWorker.worker-cf930f38.js")}const h=r({name:"TopSheet",props:{fileSystemConfig:{type:Object,required:!0},subfolder:{type:String,required:!0},files:{type:Array,required:!0},yaml:{type:String,required:!0},allConfigFiles:{type:Object,required:!0},cardId:String},data:()=>({globalState:o.state,solverThread:null,table:[],entries:[],title:""}),mounted(){this.files.length&&this.runTopSheet()},beforeDestroy(){try{this.solverThread&&(this.solverThread.terminate(),this.solverThread=null)}catch(t){console.warn(t)}},watch:{"globalState.locale"(){this.solverThread&&this.solverThread.postMessage({command:"updateCalculations",entries:this.entries,locale:this.globalState.locale})}},methods:{formattedValue(t){return isNaN(t)?t===void 0?"-?-":t:t.toLocaleString([this.$store.state.locale,"en"])},async boxChanged(){console.log("changed!"),this.solverThread&&this.solverThread.postMessage({command:"updateCalculations",entries:this.entries,locale:this.globalState.locale})},async runTopSheet(){if(this.files.length)try{this.solverThread||(console.log("spawning topsheet thread"),this.solverThread=new c,this.solverThread.onmessage=t=>{this.processWorkerMessage(t)}),this.solverThread.postMessage({command:"runTopSheet",fileSystemConfig:this.fileSystemConfig,subfolder:this.subfolder,files:this.files,yaml:this.yaml,locale:this.$store.state.locale,allConfigFiles:this.allConfigFiles})}catch(t){const e=""+t;console.log(e),this.table=[]}},processWorkerMessage(t){const e=t.data;switch(e.response){case"title":this.cardId?this.$emit("titles",e.title):this.title=e.title;break;case"entries":this.entries=e.entryFields;break;case"results":this.table=e.results,this.$emit("isLoaded");break;case"error":this.$emit("error",`${this.yaml}: ${e.message}`),this.$emit("isLoaded");break;default:this.$emit("isLoaded"),console.error(e)}}}});var d=function(){var e=this,s=e._self._c;return e._self._setupProxy,s("div",{staticClass:"topsheet curate-content"},[e.title?s("h3",{staticClass:"curate-heading"},[e._v(" "+e._s(e.title))]):e._e(),e.entries.length?s("div",{staticClass:"output-table"},e._l(e.entries,function(l,a){return s("div",{key:"entry"+a,staticClass:"row"},[s("div",{staticClass:"cell top-label",style:l.style},[e._v(e._s(l.title))]),s("b-input",{staticClass:"b-input-tight cell top-value",style:l.style,on:{input:e.boxChanged},model:{value:l.value,callback:function(i){e.$set(l,"value",i)},expression:"row.value"}})],1)}),0):e._e(),e.table.length?s("div",{staticClass:"output-table",staticStyle:{"margin-top":"1rem"}},e._l(e.table,function(l,a){return s("div",{key:"row"+a,staticClass:"row"},[s("div",{staticClass:"cell top-label",style:l.style},[e._v(e._s(l.title))]),s("div",{staticClass:"cell top-value",style:l.style},[e._v(e._s(e.formattedValue(l.value)))])])}),0):e._e()])},u=[];var p=n(h,d,u,!1,null,"60149390",null,null);const g=p.exports;export{g as T};
//# sourceMappingURL=TopSheet-f6bbf3c3.js.map
