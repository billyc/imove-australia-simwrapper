{"version":3,"file":"TransitDemand-5f7e275a.js","sources":["../../src/components/LeftDataPanel.vue","../../src/plugins/transit-demand/LegendBox.vue","../../src/plugins/transit-demand/TransitDemand.vue"],"sourcesContent":["<template lang=\"pug\">\n#datapanel\n  .content-area(:class=\"{'is-hidden': isHidden, 'bye': isLeaving}\")\n    .info-header(v-if=\"title\")\n      h3(style=\"padding: 0.5rem 3rem; font-size: 1rem; font-weight: normal; color: white;\") {{ title }}\n\n    .top-area\n      slot\n\n  .restore-button(:class=\"{'add-margin': !isHidden}\")\n    button.button.is-small.hide-button(@click=\"toggleHidePanel\")\n      i.fa.fa-arrow-left(v-if=\"!isHidden\")\n      i.fa.fa-arrow-right(v-if=\"isHidden\")\n\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  name: 'LeftDataPanel',\n  props: {\n    title: String,\n  },\n  data: () => {\n    return {\n      isHidden: false,\n      isLeaving: false,\n    }\n  },\n  methods: {\n    toggleHidePanel() {\n      if (this.isHidden) this.isHidden = !this.isHidden\n      else {\n        this.isLeaving = true\n        setTimeout(() => {\n          this.isHidden = true\n          this.isLeaving = false\n        }, 300)\n      }\n    },\n  },\n})\n</script>\n\n<style scoped lang=\"scss\">\n#datapanel {\n  display: flex;\n  flex-direction: row;\n  z-index: 7;\n  // margin: 0.5rem 0rem 0.5rem 0.5rem;\n  pointer-events: none;\n}\n\n.content-area {\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.1);\n  animation: 0.3s ease 0s 1 slideInFromLeft;\n  pointer-events: auto;\n}\n\n.is-hidden {\n  display: none;\n}\n\n.bye {\n  animation: 0.3s ease 0s 1 slideOutToLeft;\n}\n\n.top-area {\n  flex-grow: 1;\n  overflow-y: auto;\n  display: flex;\n  flex-direction: column;\n  // background-color: #eeeefff4;\n  background-color: #d9ddec;\n  border-bottom-left-radius: 0.25rem;\n  border-bottom-right-radius: 0.25rem;\n  opacity: 0.97;\n}\n\n.lower-area {\n  padding: 0.5rem 0.5rem;\n}\n\n.bottom-nav-bar {\n  padding: 0.2rem 0rem;\n  background-color: white;\n  text-align: center;\n  border-bottom-left-radius: 0.25rem;\n  border-bottom-right-radius: 0.25rem;\n}\n\n.restore-button {\n  margin: auto 0rem 0.25rem 0.25rem;\n  pointer-events: auto;\n  box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.2), 0 3px 10px 0 rgba(0, 0, 0, 0.1);\n}\n\n.info-header {\n  text-align: center;\n  background-color: #09357c;\n  padding: 0.5rem 0rem;\n  // border-top-left-radius: 0.25rem;\n  // border-top-right-radius: 0.25rem;\n  border-top: solid 1px #888;\n  border-bottom: solid 1px #888;\n}\n\n.add-margin {\n  margin-left: 0.4rem;\n}\n\n.hide-button {\n  background-color: #4e6b3d;\n  color: white;\n}\n\n@keyframes slideInFromLeft {\n  from {\n    transform: translateX(-100%);\n  }\n  to {\n    transform: translateX(0);\n  }\n}\n\n@keyframes slideOutToLeft {\n  from {\n    transform: translateX(0);\n  }\n  to {\n    transform: translateX(-100%);\n  }\n}\n\n@media only screen and (max-width: 640px) {\n  #datapanel {\n    margin: 0rem 0rem 0rem 0rem;\n  }\n\n  .content-area {\n    margin-bottom: 0rem;\n  }\n\n  .info-header {\n    border-top-left-radius: 0rem;\n    border-top-right-radius: 0rem;\n    border-top: none;\n  }\n\n  .bottom-nav-bar {\n    border-bottom-left-radius: 0rem;\n    border-bottom-right-radius: 0rem;\n  }\n}\n</style>\n","<template lang=\"pug\">\n.legend-container\n  p.control-label Legend\n  .legend-item(v-for=\"item in rows\" :key=\"item[0]\")\n    .legend-col-1(:style=\"{'background-color': item[0]}\")\n    span.legend-col-2 {{ item[1] }}\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  name: 'LegendBox',\n  props: {\n    rows: { type: Array, required: true },\n  },\n})\n</script>\n\n<style scoped lang=\"scss\">\n@import '@/styles.scss';\n\n.legend-container {\n  display: flex;\n  flex-direction: column;\n  color: var(--text);\n\n  h3 {\n    font-size: 1rem;\n    margin-bottom: 0.25rem;\n  }\n}\n\n.control-label {\n  margin: 0 0;\n  font-size: 0.8rem;\n  font-weight: bold;\n}\n\n.legend-item {\n  display: flex;\n  flex-direction: row;\n  margin-bottom: 0.25rem;\n  font-size: 0.8rem;\n}\n\n.legend-col-1 {\n  width: 3rem;\n}\n\n.legend-col-2 {\n  margin-left: 1rem;\n}\n\np.title {\n  font-size: 0.9rem;\n  text-transform: uppercase;\n  margin-bottom: 1rem;\n  font-weight: normal;\n}\n</style>\n","<template lang=\"pug\">\n.transit-viz(:class=\"{'hide-thumbnail': !thumbnail}\")\n  .map-container(:class=\"{'hide-thumbnail': !thumbnail }\")\n    div.map-styles(:id=\"mapID\")\n      .stop-marker(v-for=\"stop in stopMarkers\" :key=\"stop.i\"\n        :style=\"{transform: 'translate(-50%,-50%) rotate('+stop.bearing+'deg)', left: stop.xy.x + 'px', top: stop.xy.y+'px'}\"\n      )\n\n    legend-box.legend(v-if=\"!thumbnail\"\n      :rows=\"legendRows\"\n    )\n\n  zoom-buttons(v-if=\"!thumbnail\")\n  //- drawing-tool(v-if=\"!thumbnail\")\n\n  collapsible-panel.left-side(v-if=\"!thumbnail\"\n    :darkMode=\"isDarkMode\"\n    :locked=\"true\"\n    direction=\"left\")\n\n    .panel-items\n      //- .panel-item(v-if=\"vizDetails.title\")\n      //-   h3 {{ vizDetails.title }}\n      //-   p {{ vizDetails.description }}\n\n      .route-list(v-if=\"routesOnLink.length > 0\")\n        .route(v-for=\"route in routesOnLink\"\n            :key=\"route.uniqueRouteID\"\n            :class=\"{highlightedRoute: selectedRoute && route.id === selectedRoute.id}\"\n            @click=\"showRouteDetails(route.id)\")\n          .route-title {{route.id}}\n          .detailed-route-data\n            .col\n              p: b {{route.departures}} departures\n              p First: {{route.firstDeparture}}\n              p Last: {{route.lastDeparture}}\n            .col(v-if=\"route.passengersAtArrival\")\n              p: b {{ route.passengersAtArrival }} passengers\n              p {{ route.totalVehicleCapacity }} capacity\n\n  .control-panel(v-if=\"!thumbnail\"\n    :class=\"{'is-dashboard': config !== undefined }\"\n  )\n\n    .panel-item\n      p.control-label {{  $t('metrics') }}:\n      .metric-buttons\n        button.button.is-small.metric-button(\n          v-for=\"metric,i in metrics\" :key=\"metric.field\"\n          :style=\"{'color': activeMetric===metric.field ? 'white' : buttonColors[i], 'border': `1px solid ${buttonColors[i]}`, 'border-right': `0.4rem solid ${buttonColors[i]}`,'border-radius': '4px', 'background-color': activeMetric===metric.field ? buttonColors[i] : isDarkMode ? '#333':'white'}\"\n          @click=\"handleClickedMetric(metric)\") {{ $i18n.locale === 'de' ? metric.name_de : metric.name_en }}\n\n  .status-corner(v-if=\"!thumbnail && loadingText\")\n    p {{ loadingText }}\n\n</template>\n\n<script lang=\"ts\">\nconst i18n = {\n  messages: {\n    en: { metrics: 'Metrics', viewer: 'Transit Network' },\n    de: { metrics: 'Metrics', viewer: 'Ã–V Netzwerk' },\n  },\n}\n\nimport { defineComponent } from 'vue'\nimport type { PropType } from 'vue'\n\nimport * as turf from '@turf/turf'\nimport colormap from 'colormap'\nimport crossfilter from 'crossfilter2'\nimport maplibregl, { GeoJSONSource, LngLatBoundsLike, LngLatLike, Popup } from 'maplibre-gl'\nimport Papa from '@simwrapper/papaparse'\nimport yaml from 'yaml'\n\nimport globalStore from '@/store'\nimport CollapsiblePanel from '@/components/CollapsiblePanel.vue'\nimport HTTPFileSystem from '@/js/HTTPFileSystem'\nimport LeftDataPanel from '@/components/LeftDataPanel.vue'\nimport { Network, NetworkInputs, NetworkNode, TransitLine, RouteDetails } from './Interfaces'\nimport NewXmlFetcher from '@/workers/NewXmlFetcher.worker?worker'\nimport TransitSupplyWorker from './TransitSupplyHelper.worker?worker'\nimport LegendBox from './LegendBox.vue'\nimport DrawingTool from '@/components/DrawingTool/DrawingTool.vue'\nimport ZoomButtons from '@/components/ZoomButtons.vue'\n\nimport { FileSystem, FileSystemConfig, ColorScheme, VisualizationPlugin } from '@/Globals'\n\nimport GzipWorker from '@/workers/GzipFetcher.worker?worker'\n\nconst DEFAULT_PROJECTION = 'EPSG:31468' // 31468' // 2048'\n\nconst COLOR_CATEGORIES = 10\nconst SHOW_STOPS_AT_ZOOM_LEVEL = 11\n\nclass Departure {\n  public total: number = 0\n  public routes: Set<string> = new Set()\n}\n\nconst MyComponent = defineComponent({\n  name: 'TransitViewer',\n  i18n,\n  components: { CollapsiblePanel, LeftDataPanel, LegendBox, DrawingTool, ZoomButtons },\n\n  props: {\n    root: { type: String, required: true },\n    subfolder: { type: String, required: true },\n    yamlConfig: String,\n    config: { type: Object as any },\n    thumbnail: Boolean,\n  },\n\n  data: () => {\n    const metrics = [{ field: 'departures', name_en: 'Departures', name_de: 'Abfahrten' }]\n\n    return {\n      mapPopup: new Popup({\n        closeButton: false,\n        closeOnClick: false,\n      }),\n      buttonColors: ['#5E8AAE', '#BF7230', '#269367', '#9C439C'],\n      metrics: metrics,\n      activeMetric: metrics[0].field as any,\n      vizDetails: {\n        transitSchedule: '',\n        network: '',\n        demand: '',\n        projection: '',\n        title: '',\n        description: '',\n      },\n      myState: {\n        subfolder: '',\n        yamlConfig: '',\n        thumbnail: true,\n      },\n      isDarkMode: globalStore.state.isDarkMode,\n      isMapMoving: false,\n      loadingText: 'MATSim Transit Inspector',\n      mymap: null as any,\n      mapID: `map-id-${Math.floor(1e12 * Math.random())}` as any,\n\n      projection: DEFAULT_PROJECTION,\n      routesOnLink: [] as any[],\n      selectedRoute: {} as any,\n      stopMarkers: [] as any[],\n\n      _attachedRouteLayers: [] as string[],\n      _departures: {} as { [linkID: string]: Departure },\n      _linkData: null as any,\n      _mapExtentXYXY: null as any,\n      _maximum: -Infinity,\n      _network: {} as Network,\n      _routeData: {} as { [index: string]: RouteDetails },\n      _stopFacilities: {} as { [index: string]: NetworkNode },\n      _transitLines: {} as { [index: string]: TransitLine },\n      _roadFetcher: {} as any,\n      _transitFetcher: {} as any,\n      _transitHelper: {} as any,\n      _transitLinks: null as any,\n      _geoTransitLinks: null as any,\n\n      resolvers: {} as { [id: number]: any },\n      resolverId: 0,\n      xmlWorker: null as null | Worker,\n      cfDemand: null as crossfilter.Crossfilter<any> | null,\n      cfDemandLink: null as crossfilter.Dimension<any, any> | null,\n      hoverWait: false,\n    }\n  },\n\n  computed: {\n    fileApi(): HTTPFileSystem {\n      return new HTTPFileSystem(this.fileSystem, globalStore)\n    },\n\n    fileSystem(): FileSystemConfig {\n      const svnProject: FileSystemConfig[] = this.$store.state.svnProjects.filter(\n        (a: FileSystemConfig) => a.slug === this.root\n      )\n      if (svnProject.length === 0) {\n        console.log('no such project')\n        throw Error\n      }\n      return svnProject[0]\n    },\n\n    legendRows(): string[][] {\n      return [\n        ['#a03919', 'Rail'],\n        ['#448', 'Bus'],\n      ]\n    },\n  },\n\n  watch: {\n    '$store.state.resizeEvents'() {\n      if (this.mymap) this.mymap.resize()\n    },\n\n    '$store.state.viewState'({ bearing, longitude, latitude, zoom, pitch }: any) {\n      // ignore my own farts; they smell like roses\n      if (!this.mymap || this.isMapMoving) {\n        this.isMapMoving = false\n        return\n      }\n\n      // sometimes closing a view returns a null map, ignore it!\n      if (!zoom) return\n\n      this.mymap.off('move', this.handleMapMotion)\n\n      this.mymap.jumpTo({\n        bearing,\n        zoom,\n        center: [longitude, latitude],\n        pitch,\n      })\n\n      this.mymap.on('move', this.handleMapMotion)\n\n      if (this.stopMarkers.length > 0) this.showTransitStops()\n    },\n\n    '$store.state.colorScheme'() {\n      this.isDarkMode = this.$store.state.colorScheme === ColorScheme.DarkMode\n      if (!this.mymap) return\n\n      this.removeAttachedRoutes()\n\n      this.mymap.setStyle(globalStore.getters.mapStyle)\n\n      this.mymap.on('style.load', () => {\n        if (this._geoTransitLinks) this.addTransitToMap(this._geoTransitLinks)\n        this.highlightAllAttachedRoutes()\n        if (this.selectedRoute) this.showTransitRoute(this.selectedRoute.id)\n      })\n    },\n  },\n\n  methods: {\n    async getVizDetails() {\n      // are we in a dashboard?\n      if (this.config) {\n        this.vizDetails = Object.assign({}, this.config)\n        return true\n      }\n\n      // if a YAML file was passed in, just use it\n      if (this.myState.yamlConfig?.endsWith('yaml') || this.myState.yamlConfig?.endsWith('yml')) {\n        return this.loadYamlConfig()\n      }\n\n      // Build the config based on folder contents\n      const title = this.myState.yamlConfig.substring(\n        0,\n        15 + this.myState.yamlConfig.indexOf('transitSchedule')\n      )\n\n      this.vizDetails = {\n        transitSchedule: this.myState.yamlConfig,\n        network: '',\n        title,\n        description: '',\n        demand: '',\n        projection: '',\n      }\n\n      this.$emit('title', title)\n      return true\n    },\n\n    async prepareView() {\n      const { files } = await this.fileApi.getDirectory(this.myState.subfolder)\n\n      // Road network: first try the most obvious network filename:\n      let network =\n        this.vizDetails.network ?? this.myState.yamlConfig.replaceAll('transitSchedule', 'network')\n\n      // if the obvious network file doesn't exist, just grab... the first network file:\n      if (files.indexOf(network) == -1) {\n        const allNetworks = files.filter(f => f.endsWith('network.xml.gz'))\n        if (allNetworks.length) network = allNetworks[0]\n        else {\n          this.loadingText = 'No road network found.'\n          network = ''\n        }\n      }\n\n      // Departures: use them if we are in an output folder (and they exist)\n      let demandFiles = [] as string[]\n      if (this.myState.yamlConfig.indexOf('output_transitSchedule') > -1) {\n        demandFiles = files.filter(f => f.endsWith('pt_stop2stop_departures.csv.gz'))\n      }\n\n      // Save everything\n      this.vizDetails.network = network\n      if (demandFiles.length) this.vizDetails.demand = demandFiles[0]\n    },\n\n    async guessProjection(networks: any): Promise<string> {\n      // 00. If it's in config, use it\n      if (this.vizDetails.projection) return this.vizDetails.projection\n      if (this.config?.projection) return this.config.projection\n\n      // 0. If it's in the network, use it\n      if (networks?.roadXML?.network?.attributes?.attribute?.name === 'coordinateReferenceSystem') {\n        return networks?.roadXML?.network?.attributes?.attribute['#text']\n      }\n\n      // 1. if we have it in storage already, use it\n      const storagePath = `${this.root}/${this.subfolder}`\n      let savedConfig = undefined // localStorage.getItem(storagePath) as any\n\n      const goodEPSG = /EPSG:.\\d/\n\n      if (savedConfig) {\n        try {\n          const config = JSON.parse(savedConfig)\n\n          if (goodEPSG.test(config.networkProjection)) {\n            return config.networkProjection\n          } else {\n            savedConfig = {}\n          }\n        } catch (e) {\n          console.error('bad saved config in storage', savedConfig)\n          savedConfig = {}\n          // fail! ok try something else\n        }\n      }\n\n      // 2. try to get it from config\n      const { files } = await this.fileApi.getDirectory(this.myState.subfolder)\n      const outputConfigs = files.filter(\n        f => f.indexOf('.output_config.xml') > -1 || f.indexOf('.output_config_reduced.xml') > -1\n      )\n      if (outputConfigs.length && this.fileSystem) {\n        // console.log('trying to find CRS in', outputConfigs[0])\n\n        for (const xmlConfigFileName of outputConfigs) {\n          try {\n            const configXML: any = await this.fetchXML({\n              worker: null,\n              slug: this.fileSystem.slug,\n              filePath: this.myState.subfolder + '/' + xmlConfigFileName,\n            })\n\n            const global = configXML.config.module.filter((f: any) => f.$name === 'global')[0]\n            const crs = global.param.filter((p: any) => p.$name === 'coordinateSystem')[0]\n\n            const crsValue = crs.$value\n\n            // save it\n            // savedConfig = savedConfig || {}\n            // savedConfig.networkProjection = crsValue\n            // localStorage.setItem(storagePath, JSON.stringify(savedConfig))\n            return crsValue\n          } catch (e) {\n            console.warn('Failed parsing', xmlConfigFileName)\n          }\n        }\n      }\n\n      // 3. ask the user\n      let entry = prompt('Need coordinate EPSG number:', '') || ''\n\n      // if user cancelled, give up\n      if (!entry) return ''\n      // if user gave bad answer, try again\n      if (isNaN(parseInt(entry, 10)) && !goodEPSG.test(entry)) return this.guessProjection(networks)\n\n      // hopefully user gave a good EPSG number\n      if (!entry.startsWith('EPSG:')) entry = 'EPSG:' + entry\n\n      const networkProjection = entry\n      localStorage.setItem(storagePath, JSON.stringify({ networkProjection }))\n      return networkProjection\n    },\n\n    async loadYamlConfig() {\n      const filename =\n        this.myState.yamlConfig.indexOf('/') > -1\n          ? this.myState.yamlConfig\n          : this.myState.subfolder + '/' + this.myState.yamlConfig\n\n      try {\n        const text = await this.fileApi.getFileText(filename)\n        this.vizDetails = yaml.parse(text)\n      } catch (e) {\n        // maybe it failed because password?\n        const err = e as any\n        if (this.fileSystem && this.fileSystem.needPassword && err.status === 401) {\n          this.$store.commit('requestLogin', this.fileSystem.slug)\n        } else {\n          const msg = 'Could not load ' + filename\n          this.$emit('error', msg)\n          this.loadingText = msg\n        }\n        return false\n      }\n\n      const t = this.vizDetails.title ? this.vizDetails.title : 'Transit Ridership'\n      this.$emit('title', t)\n\n      this.projection = this.vizDetails.projection\n      return true\n    },\n\n    isMobile() {\n      const w = window\n      const d = document\n      const e = d.documentElement\n      const g = d.getElementsByTagName('body')[0]\n      const x = w.innerWidth || e.clientWidth || g.clientWidth\n      const y = w.innerHeight || e.clientHeight || g.clientHeight\n      return x < 640\n    },\n\n    setupMap() {\n      try {\n        this.mymap = new maplibregl.Map({\n          bearing: 0,\n          container: this.mapID,\n          logoPosition: 'bottom-left',\n          style: globalStore.getters.mapStyle,\n          pitch: 0,\n        })\n\n        const extent = localStorage.getItem(this.$route.fullPath + '-bounds')\n\n        if (extent) {\n          try {\n            const lnglat = JSON.parse(extent)\n            const mFac = this.isMobile() ? 0 : 1\n            const padding = { top: 50 * mFac, bottom: 50 * mFac, right: 50 * mFac, left: 50 * mFac }\n\n            this.mymap.fitBounds(lnglat, {\n              animate: false,\n              padding,\n            })\n          } catch (e) {\n            // ignore this, it's ok\n          }\n        }\n        // Start doing stuff AFTER the MapBox library has fully initialized\n        this.mymap.on('load', this.mapIsReady)\n        this.mymap.on('move', this.handleMapMotion)\n        this.mymap.on('click', this.handleEmptyClick)\n\n        this.mymap.keyboard.disable() // so arrow keys don't pan\n      } catch (e) {\n        console.error('' + e)\n\n        // no worries\n      }\n    },\n\n    handleClickedMetric(metric: { field: string }) {\n      console.log('transit metric:', metric.field)\n\n      this.activeMetric = metric.field\n\n      let widthExpression: any = 3\n\n      switch (metric.field) {\n        case 'departures':\n          widthExpression = ['max', 2, ['*', 0.03, ['get', 'departures']]]\n          break\n\n        case 'pax':\n          widthExpression = ['max', 2, ['*', 0.003, ['get', 'pax']]]\n          break\n\n        case 'loadfac':\n          widthExpression = ['max', 2, ['*', 200, ['get', 'loadfac']]]\n          break\n      }\n\n      this.mymap.setPaintProperty('transit-link', 'line-width', widthExpression)\n    },\n\n    handleMapMotion() {\n      const mapCamera = {\n        longitude: this.mymap.getCenter().lng,\n        latitude: this.mymap.getCenter().lat,\n        bearing: this.mymap.getBearing(),\n        zoom: this.mymap.getZoom(),\n        pitch: this.mymap.getPitch(),\n      }\n\n      if (!this.isMapMoving) this.$store.commit('setMapCamera', mapCamera)\n      this.isMapMoving = true\n\n      if (this.stopMarkers.length > 0) this.showTransitStops()\n    },\n\n    handleEmptyClick(e: mapboxgl.MapMouseEvent) {\n      this.removeStopMarkers()\n      this.removeSelectedRoute()\n      this.removeAttachedRoutes()\n      this.routesOnLink = []\n    },\n\n    showRouteDetails(routeID: string) {\n      if (!routeID && !this.selectedRoute) return\n\n      console.log({ routeID })\n\n      if (routeID) this.showTransitRoute(routeID)\n      else this.showTransitRoute(this.selectedRoute.id)\n\n      this.showTransitStops()\n    },\n\n    async mapIsReady() {\n      const networks = await this.loadNetworks()\n      const projection = await this.guessProjection(networks)\n      this.vizDetails.projection = projection\n      this.projection = this.vizDetails.projection\n      console.log(projection)\n\n      if (networks) this.processInputs(networks)\n\n      // TODO remove for now until we research whether this causes a memory leak:\n      // this.setupKeyListeners()\n    },\n\n    setupKeyListeners() {\n      window.addEventListener('keyup', event => {\n        if (event.keyCode === 27) {\n          // ESC\n          this.pressedEscape()\n        }\n      })\n      window.addEventListener('keydown', event => {\n        if (event.keyCode === 38) {\n          this.pressedArrowKey(-1) // UP\n        }\n        if (event.keyCode === 40) {\n          this.pressedArrowKey(+1) // DOWN\n        }\n      })\n    },\n\n    fetchXML(props: { worker: any; slug: string; filePath: string; options?: any }) {\n      let xmlWorker = props.worker\n\n      xmlWorker.onmessage = (message: MessageEvent) => {\n        // message.data will have .id and either .error or .xml\n        const { resolve, reject } = this.resolvers[message.data.id]\n\n        xmlWorker.terminate()\n\n        if (message.data.error) reject(message.data.error)\n        resolve(message.data.xml)\n      }\n\n      // save the promise by id so we can look it up when we get messages\n      const id = this.resolverId++\n\n      xmlWorker.postMessage({\n        id,\n        fileSystem: this.fileSystem,\n        filePath: props.filePath,\n        options: props.options,\n      })\n\n      const promise = new Promise((resolve, reject) => {\n        this.resolvers[id] = { resolve, reject }\n      })\n      return promise\n    },\n\n    async loadNetworks() {\n      try {\n        if (!this.fileSystem || !this.vizDetails.network || !this.vizDetails.transitSchedule) return\n\n        this.loadingText = 'Loading networks...'\n\n        const roads = this.fetchXML({\n          worker: this._roadFetcher,\n          slug: this.fileSystem.slug,\n          filePath: this.myState.subfolder + '/' + this.vizDetails.network,\n          options: { attributeNamePrefix: '' },\n        })\n\n        const transit = this.fetchXML({\n          worker: this._transitFetcher,\n          slug: this.fileSystem.slug,\n          filePath: this.myState.subfolder + '/' + this.vizDetails.transitSchedule,\n          options: {\n            attributeNamePrefix: '',\n            alwaysArray: [\n              'transitSchedule.transitLine.transitRoute',\n              'transitSchedule.transitLine.transitRoute.departures.departure',\n            ],\n          },\n        })\n\n        // and wait for them to all complete\n        const results = await Promise.all([roads, transit])\n        return { roadXML: results[0], transitXML: results[1], ridership: [] }\n      } catch (e) {\n        console.error('TRANSIT:', e)\n        this.loadingText = '' + e\n        globalStore.commit('error', 'Transit: ' + e)\n        return null\n      }\n    },\n\n    loadDemandData(filename: string): Promise<any[]> {\n      const promise: Promise<any[]> = new Promise<any[]>((resolve, reject) => {\n        if (!filename) resolve([])\n        this.loadingText = 'Loading demand...'\n        const worker = new GzipWorker() as Worker\n\n        worker.onmessage = (event: MessageEvent) => {\n          this.loadingText = 'Processing demand...'\n          const csvData = new TextDecoder('utf-8').decode(event.data)\n          worker.terminate()\n\n          Papa.parse(csvData, {\n            // preview: 10000,\n            header: true,\n            skipEmptyLines: true,\n            dynamicTyping: true,\n            worker: true,\n            complete: (results: any) => {\n              resolve(this.processDemand(results))\n            },\n          })\n        }\n\n        worker.postMessage({\n          filePath: this.myState.subfolder + '/' + filename,\n          fileSystem: this.fileSystem,\n        })\n      })\n      return promise\n    },\n\n    processDemand(results: any) {\n      // todo: make sure meta contains fields we need!\n      this.loadingText = 'Processing demand data...'\n\n      // build crossfilter\n      console.log('BUILD crossfilter')\n      this.cfDemand = crossfilter(results.data)\n      this.cfDemandLink = this.cfDemand.dimension((d: any) => d.linkIdsSincePreviousStop)\n\n      // build link-level passenger ridership\n      console.log('COUNTING RIDERSHIP')\n\n      const linkPassengersById = {} as any\n      const group = this.cfDemandLink.group()\n      group\n        .reduceSum((d: any) => d.passengersAtArrival)\n        .all()\n        .map(link => {\n          linkPassengersById[link.key as any] = link.value\n        })\n\n      // and pax load-factors\n      const capacity = {} as any\n      group\n        .reduceSum((d: any) => d.totalVehicleCapacity)\n        .all()\n        .map(link => {\n          capacity[link.key as any] = link.value\n        })\n\n      // update passenger value in the transit-link geojson.\n      for (const transitLink of this._transitLinks.features) {\n        transitLink.properties['pax'] = linkPassengersById[transitLink.properties.id]\n        transitLink.properties['cap'] = capacity[transitLink.properties.id]\n        transitLink.properties['loadfac'] =\n          Math.round(\n            (1000 * linkPassengersById[transitLink.properties.id]) /\n              capacity[transitLink.properties.id]\n          ) / 1000\n      }\n\n      this.metrics = this.metrics.concat([\n        { field: 'pax', name_en: 'Passengers', name_de: 'Passagiere' },\n        { field: 'loadfac', name_en: 'Load Factor', name_de: 'Auslastung' },\n      ])\n\n      const source = this.mymap.getSource('transit-source') as GeoJSONSource\n      source.setData(this._transitLinks)\n\n      this.loadingText = ''\n      return []\n    },\n\n    async processInputs(networks: NetworkInputs) {\n      this.loadingText = 'Preparing...'\n      // spawn transit helper web worker\n      this._transitHelper = new TransitSupplyWorker()\n\n      this._transitHelper.onmessage = async (buffer: MessageEvent) => {\n        this.receivedProcessedTransit(buffer)\n      }\n\n      this._transitHelper.postMessage({\n        xml: networks,\n        projection: this.projection,\n      })\n    },\n\n    async receivedProcessedTransit(buffer: MessageEvent) {\n      if (buffer.data.status) {\n        this.loadingText = buffer.data.status\n        return\n      }\n\n      if (buffer.data.error) {\n        console.error(buffer.data.error)\n        this.$emit('error', buffer.data.error)\n        return\n      }\n\n      const { network, routeData, stopFacilities, transitLines, mapExtent } = buffer.data\n      this._network = network\n      this._routeData = routeData\n      this._stopFacilities = stopFacilities\n      this._transitLines = transitLines\n      this._mapExtentXYXY = mapExtent\n\n      this._transitHelper.terminate()\n\n      this.loadingText = 'Summarizing departures...'\n\n      await this.processDepartures()\n\n      // Build the links layer and add it\n      this._transitLinks = await this.constructDepartureFrequencyGeoJson()\n      this.addTransitToMap(this._transitLinks)\n\n      this.handleClickedMetric({ field: 'departures' })\n\n      localStorage.setItem(this.$route.fullPath + '-bounds', JSON.stringify(this._mapExtentXYXY))\n      this.mymap.fitBounds(this._mapExtentXYXY, { animate: false })\n\n      if (this.vizDetails.demand) await this.loadDemandData(this.vizDetails.demand)\n\n      this.loadingText = ''\n    },\n\n    async processDepartures() {\n      this.loadingText = 'Processing departures...'\n\n      for (const id in this._transitLines) {\n        if (this._transitLines.hasOwnProperty(id)) {\n          const transitLine = this._transitLines[id]\n          for (const route of transitLine.transitRoutes) {\n            for (const linkID of route.route) {\n              if (!(linkID in this._departures))\n                this._departures[linkID] = { total: 0, routes: new Set() }\n\n              this._departures[linkID].total += route.departures\n              this._departures[linkID].routes.add(route.id)\n\n              this._maximum = Math.max(this._maximum, this._departures[linkID].total)\n            }\n          }\n        }\n      }\n    },\n\n    addTransitToMap(geodata: any) {\n      this._geoTransitLinks = geodata\n\n      this.mymap.addSource('transit-source', {\n        data: geodata,\n        type: 'geojson',\n      } as any)\n\n      this.mymap.addLayer({\n        id: 'transit-link',\n        source: 'transit-source',\n        type: 'line',\n        paint: {\n          'line-opacity': 1.0,\n          'line-width': 1,\n          'line-color': ['get', 'color'],\n        },\n      })\n\n      this.mymap.on('click', 'transit-link', (e: maplibregl.MapMouseEvent) => {\n        this.clickedOnTransitLink(e)\n      })\n\n      // turn \"hover cursor\" into a pointer, so user knows they can click.\n      this.mymap.on('mousemove', 'transit-link', (e: maplibregl.MapLayerMouseEvent) => {\n        this.mymap.getCanvas().style.cursor = e ? 'pointer' : 'grab'\n        this.hoveredOnElement(e)\n      })\n\n      // and back to normal when they mouse away\n      this.mymap.on('mouseleave', 'transit-link', () => {\n        this.mymap.getCanvas().style.cursor = 'grab'\n        this.mapPopup.remove()\n      })\n    },\n\n    hoveredOnElement(event: any) {\n      const props = event.features[0].properties\n\n      let content = '<div class=\"map-popup\">'\n\n      for (const metric of this.metrics) {\n        let label = this.$i18n.locale == 'de' ? metric.name_de : metric.name_en\n        label = label.replaceAll(' ', '&nbsp;')\n\n        if (!isNaN(props[metric.field]))\n          content += `\n          <div style=\"display: flex\">\n            <div>${label}:&nbsp;&nbsp;</div>\n            <b style=\"margin-left: auto; text-align: right\">${props[metric.field]}</b>\n          </div>`\n      }\n\n      content += '<div>'\n      this.mapPopup.setLngLat(event.lngLat).setHTML(content).addTo(this.mymap)\n    },\n\n    async constructDepartureFrequencyGeoJson() {\n      const geojson = []\n\n      for (const linkID in this._departures) {\n        if (this._departures.hasOwnProperty(linkID)) {\n          const link = this._network.links[linkID]\n          if (!link) continue\n\n          const coordinates = [\n            [this._network.nodes[link.from].x, this._network.nodes[link.from].y],\n            [this._network.nodes[link.to].x, this._network.nodes[link.to].y],\n          ]\n\n          const departures = this._departures[linkID].total\n\n          // shift scale from 0->1 to 0.25->1.0, because dark blue is hard to see on a black map\n          const ratio = 0.25 + (0.75 * (departures - 1)) / this._maximum\n          const colorBin = Math.floor(COLOR_CATEGORIES * ratio)\n\n          let isRail = true\n          for (const route of this._departures[linkID].routes) {\n            if (this._routeData[route].transportMode === 'bus') {\n              isRail = false\n            }\n          }\n\n          let line = {\n            type: 'Feature',\n            geometry: {\n              type: 'LineString',\n              coordinates: coordinates,\n            },\n            properties: {\n              color: isRail ? '#a03919' : _colorScale[colorBin],\n              colorBin: colorBin,\n              departures: departures,\n              // pax: 0,\n              // loadfac: 0,\n              // cap: 0,\n              id: linkID,\n              isRail: isRail,\n              from: link.from, // _stopFacilities[fromNode].name || fromNode,\n              to: link.to, // _stopFacilities[toNode].name || toNode,\n            },\n          }\n\n          line = this.offsetLineByMeters(line, 15)\n          geojson.push(line)\n        }\n      }\n\n      geojson.sort(function (a: any, b: any) {\n        if (a.isRail && !b.isRail) return -1\n        if (b.isRail && !a.isRail) return 1\n        return 0\n      })\n\n      return { type: 'FeatureCollection', features: geojson }\n    },\n\n    offsetLineByMeters(line: any, metersToTheRight: number) {\n      try {\n        const offsetLine = turf.lineOffset(line, metersToTheRight, { units: 'meters' })\n        return offsetLine\n      } catch (e) {\n        // offset can fail if points are exactly on top of each other; ignore.\n      }\n      return line\n    },\n\n    removeStopMarkers() {\n      this.stopMarkers = []\n    },\n\n    async showTransitStops() {\n      this.removeStopMarkers()\n\n      const route = this.selectedRoute\n      const stopSizeClass = 'stopmarker' // this.mymap.getZoom() > SHOW_STOPS_AT_ZOOM_LEVEL ? 'stop-marker-big' : 'stop-marker'\n      const mapBearing = this.mymap.getBearing()\n\n      let bearing\n\n      for (const [i, stop] of route.routeProfile.entries()) {\n        const coord = [this._stopFacilities[stop.refId].x, this._stopFacilities[stop.refId].y]\n        // recalc bearing for every node except the last\n        if (i < route.routeProfile.length - 1) {\n          const point1 = turf.point([coord[0], coord[1]])\n          const point2 = turf.point([\n            this._stopFacilities[route.routeProfile[i + 1].refId].x,\n            this._stopFacilities[route.routeProfile[i + 1].refId].y,\n          ])\n          bearing = turf.bearing(point1, point2) - mapBearing // so icons rotate along with map\n        }\n\n        const xy = this.mymap.project([coord[0], coord[1]])\n\n        // every marker has a latlng coord and a bearing\n        const marker = { i, bearing, xy: { x: Math.floor(xy.x), y: Math.floor(xy.y) } }\n        this.stopMarkers.push(marker)\n      }\n    },\n\n    showTransitRoute(routeID: string) {\n      if (!routeID) return\n\n      const route = this._routeData[routeID]\n      // console.log({ selectedRoute: route })\n\n      this.selectedRoute = route\n\n      const source = this.mymap.getSource('selected-route-data') as GeoJSONSource\n      if (source) {\n        source.setData(route.geojson)\n      } else {\n        this.mymap.addSource('selected-route-data', {\n          data: route.geojson,\n          type: 'geojson',\n        })\n      }\n\n      if (!this.mymap.getLayer('selected-route')) {\n        this.mymap.addLayer({\n          id: 'selected-route',\n          source: 'selected-route-data',\n          type: 'line',\n          paint: {\n            'line-opacity': 1.0,\n            'line-width': 5, // ['get', 'width'],\n            'line-color': '#097c43', // ['get', 'color'],\n          },\n        })\n      }\n    },\n\n    removeSelectedRoute() {\n      if (this.selectedRoute) {\n        try {\n          this.mymap.removeLayer('selected-route')\n        } catch (e) {\n          // oh well\n        }\n        this.selectedRoute = null\n      }\n    },\n\n    clickedOnTransitLink(e: any) {\n      this.removeStopMarkers()\n      this.removeSelectedRoute()\n\n      // the browser delivers some details that we need, in the fn argument 'e'\n      const props = e.features[0].properties\n      const routeIDs = this._departures[props.id].routes\n\n      this.calculatePassengerVolumes(props.id)\n\n      const routes = []\n      for (const id of routeIDs) {\n        routes.push(this._routeData[id])\n      }\n\n      // sort by highest departures first\n      routes.sort(function (a, b) {\n        return a.departures > b.departures ? -1 : 1\n      })\n\n      this.routesOnLink = routes\n      this.highlightAllAttachedRoutes()\n\n      // highlight the first route, if there is one\n      if (routes.length > 0) this.showRouteDetails(routes[0].id)\n    },\n\n    calculatePassengerVolumes(id: string) {\n      if (!this.cfDemandLink || !this.cfDemand) return\n\n      this.cfDemandLink.filter(id)\n\n      const allLinks = this.cfDemand.allFiltered()\n      let sum = 0\n\n      allLinks.map(d => {\n        sum = sum + d.passengersBoarding + d.passengersAtArrival - d.passengersAlighting\n      })\n\n      // console.log({ sum, allLinks })\n    },\n\n    removeAttachedRoutes() {\n      for (const layerID of this._attachedRouteLayers) {\n        try {\n          this.mymap.removeLayer('route-' + layerID)\n          this.mymap.removeSource('source-route-' + layerID)\n        } catch (e) {\n          //meh\n        }\n      }\n      this._attachedRouteLayers = []\n    },\n\n    highlightAllAttachedRoutes() {\n      this.removeAttachedRoutes()\n\n      for (const route of this.routesOnLink) {\n        this.mymap.addSource('source-route-' + route.id, {\n          data: route.geojson,\n          type: 'geojson',\n        })\n        this.mymap.addLayer({\n          id: 'route-' + route.id,\n          source: 'source-route-' + route.id,\n          type: 'line',\n          paint: {\n            'line-opacity': 0.7,\n            'line-width': 8, // ['get', 'width'],\n            'line-color': '#ccff33', // ['get', 'color'],\n          },\n        })\n        this._attachedRouteLayers.push(route.id)\n      }\n    },\n\n    pressedEscape() {\n      this.removeSelectedRoute()\n      this.removeStopMarkers()\n      this.removeAttachedRoutes()\n\n      this.selectedRoute = null\n      this.routesOnLink = []\n    },\n\n    pressedArrowKey(delta: number) {\n      if (!this.selectedRoute) return\n\n      let i = this.routesOnLink.indexOf(this.selectedRoute)\n      i = i + delta\n\n      if (i < 0 || i >= this.routesOnLink.length) return\n\n      this.showRouteDetails(this.routesOnLink[i].id)\n    },\n\n    clearData() {\n      this._attachedRouteLayers = []\n      this._departures = {}\n      this._mapExtentXYXY = [180, 90, -180, -90]\n      this._maximum = 0\n      this._network = { nodes: {}, links: {} }\n      this._routeData = {}\n      this._stopFacilities = {}\n      this._transitLinks = null\n      this._transitLines = {}\n      this.selectedRoute = null\n      this.cfDemand = null\n      this.cfDemandLink?.dispose()\n      this.resolvers = {}\n      this.routesOnLink = []\n      this.selectedRoute = {}\n      this.stopMarkers = []\n      this._linkData = null\n      this._geoTransitLinks = null\n    },\n  },\n\n  async mounted() {\n    this.$store.commit('setFullScreen', !this.thumbnail)\n\n    this.clearData()\n\n    this._roadFetcher = new NewXmlFetcher()\n    this._transitFetcher = new NewXmlFetcher()\n    this._transitHelper = new TransitSupplyWorker()\n\n    // populate props after we attach, not before!\n    this.myState.subfolder = this.subfolder\n    this.myState.yamlConfig = this.yamlConfig ?? ''\n    this.myState.thumbnail = this.thumbnail\n\n    const status = await this.getVizDetails()\n    if (!status) return\n\n    if (this.thumbnail) return\n\n    await this.prepareView()\n    this.setupMap()\n  },\n\n  beforeDestroy() {\n    if (this.mymap) this.mymap.remove()\n\n    this.clearData()\n\n    if (this.xmlWorker) this.xmlWorker.terminate()\n    if (this._roadFetcher) this._roadFetcher.terminate()\n    if (this._transitFetcher) this._transitFetcher.terminate()\n    if (this._transitHelper) this._transitHelper.terminate()\n\n    this.$store.commit('setFullScreen', false)\n  },\n})\n\nconst _colorScale = colormap({ colormap: 'viridis', nshades: COLOR_CATEGORIES })\n\nexport default MyComponent\n</script>\n\n<style scoped lang=\"scss\">\n@import '@/styles.scss';\n\n.mapboxgl-popup-content {\n  padding: 0px 20px 0px 0px;\n  opacity: 0.95;\n  box-shadow: 0 0 3px #00000080;\n}\n\nh4,\np {\n  margin: 0px 10px;\n}\n\n.transit-popup {\n  padding: 0px 0px;\n  margin: 0px 0px;\n  border-style: solid;\n  border-width: 0px 0px 0px 20px;\n}\n\n.transit-viz {\n  position: relative;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  min-height: $thumbnailHeight;\n  background: url('assets/thumbnail.jpg') no-repeat;\n  background-size: cover;\n  pointer-events: none;\n}\n\n.map-container {\n  position: relative;\n  flex: 1;\n  pointer-events: auto;\n  background: url('assets/thumbnail.jpg') no-repeat;\n  background-color: #eee;\n  background-size: cover;\n  min-height: $thumbnailHeight;\n}\n\n.hide-thumbnail {\n  background: none;\n  z-index: 0;\n}\n\n.control-panel {\n  position: absolute;\n  bottom: 0;\n  display: flex;\n  flex-direction: row;\n  font-size: 0.8rem;\n  margin: 0 0 0.5rem 0.5rem;\n  pointer-events: auto;\n  background-color: var(--bgPanel);\n  padding: 0.5rem 0.5rem;\n  filter: drop-shadow(0px 2px 4px #22222233);\n}\n\n.is-dashboard {\n  position: static;\n  margin: 0 0;\n  padding: 0.25rem 0 0 0;\n  filter: unset;\n  background-color: unset;\n}\n\n.legend {\n  background-color: var(--bgPanel);\n  padding: 0.25rem 0.5rem;\n  position: absolute;\n  bottom: 3.5rem;\n  right: 0.5rem;\n}\n\n.control-label {\n  margin: 0 0;\n  font-size: 0.8rem;\n  font-weight: bold;\n}\n\n.route {\n  padding: 5px 0px;\n  text-align: left;\n  color: var(--text);\n  border-left: solid 8px #00000000;\n  border-right: solid 8px #00000000;\n}\n\n.route:hover {\n  background-color: var(--bgCream3);\n  cursor: pointer;\n}\n\nh3 {\n  margin: 0px 0px;\n  font-size: 1.5rem;\n  line-height: 1.7rem;\n}\n\n.route-title {\n  font-size: 1rem;\n  font-weight: bold;\n  line-height: 1.2rem;\n  margin-left: 10px;\n  color: var(--link);\n}\n\n.stopmarker {\n  width: 12px;\n  height: 12px;\n  cursor: pointer;\n}\n\n.stop-marker-big {\n  background: url('assets/icon-stop-triangle.png') no-repeat;\n  background-size: 100%;\n  width: 16px;\n  height: 16px;\n}\n\n.highlightedRoute {\n  background-color: #faffae;\n  border-left: solid 8px #606aff;\n  color: black;\n}\n\n.highlightedRoute:hover {\n  background-color: #faffae;\n}\n\n.bigtitle {\n  font-weight: bold;\n  font-style: italic;\n  font-size: 20px;\n  margin: 20px 0px;\n}\n\n.info-header {\n  text-align: center;\n  background-color: #097c43;\n  padding: 0.5rem 0rem;\n  border-top: solid 1px #888;\n  border-bottom: solid 1px #888;\n}\n\n.project-summary-block {\n  width: 16rem;\n  grid-column: 1 / 2;\n  grid-row: 1 / 2;\n  margin: 0px auto auto 0px;\n  z-index: 10;\n}\n\n@keyframes slideInFromLeft {\n  from {\n    transform: translateX(-100%);\n  }\n  to {\n    transform: translateX(0);\n  }\n}\n\n.stop-marker {\n  position: absolute;\n  width: 12px;\n  height: 12px;\n  background: url('assets/icon-stop-triangle.png') no-repeat;\n  transform: translate(-50%, -50%);\n  background-size: 100%;\n  cursor: pointer;\n}\n\n.help-text {\n  color: #ccc;\n}\n\n.left-side {\n  position: absolute;\n  top: 0;\n  left: 0;\n  margin-bottom: auto;\n  margin-right: auto;\n  display: flex;\n  flex-direction: row;\n  pointer-events: auto;\n  max-height: 40%;\n  max-width: 80%;\n  opacity: 0.96;\n}\n\n.right-side {\n  z-index: 1;\n  position: absolute;\n  bottom: 3.75rem;\n  right: 0;\n  color: white;\n  display: flex;\n  flex-direction: row;\n  pointer-events: auto;\n}\n\n.panel-items {\n  color: var(--text);\n  display: flex;\n  flex-direction: column;\n  margin: 0 0;\n  max-height: 100%;\n}\n\n.panel-item {\n  display: flex;\n  flex-direction: column;\n\n  h3 {\n    padding: 0.5rem 1rem 1.5rem 0.5rem;\n  }\n}\n\n.route-list {\n  user-select: none;\n  position: relative;\n  flex: 1;\n  overflow-y: auto;\n  overflow-x: hidden;\n  cursor: pointer;\n  scrollbar-color: #888 var(--bgCream);\n  -webkit-scrollbar-color: #888 var(--bgCream);\n\n  h3 {\n    font-size: 1.2rem;\n  }\n}\n\n.dashboard-panel {\n  display: flex;\n  flex-direction: column;\n}\n\n.metric-buttons {\n  display: flex;\n  flex-direction: row;\n}\n\n.metric-button {\n  margin-right: 0.5rem;\n}\n\n.detailed-route-data {\n  display: flex;\n  flex-direction: row;\n}\n\n.col {\n  display: flex;\n  flex-direction: column;\n}\n\n.map-styles {\n  height: 100%;\n}\n\n.status-corner {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  z-index: 15;\n  display: flex;\n  flex-direction: row;\n  background-color: var(--bgPanel);\n  padding: 0rem 3rem;\n\n  a {\n    color: white;\n    text-decoration: none;\n\n    &.router-link-exact-active {\n      color: white;\n    }\n  }\n\n  p {\n    color: var(--textFancy);\n    font-weight: normal;\n    font-size: 1.3rem;\n    line-height: 2.6rem;\n    margin: auto 0.5rem auto 0;\n    padding: 0 0;\n  }\n}\n</style>\n"],"names":["_sfc_main$1","defineComponent","_sfc_main","i18n","DEFAULT_PROJECTION","COLOR_CATEGORIES","MyComponent","CollapsiblePanel","LeftDataPanel","LegendBox","DrawingTool","ZoomButtons","metrics","Popup","globalStore","HTTPFileSystem","svnProject","a","bearing","longitude","latitude","zoom","pitch","ColorScheme","_a","_b","title","files","network","allNetworks","f","demandFiles","networks","_e","_d","_c","_h","_g","_f","storagePath","goodEPSG","outputConfigs","xmlConfigFileName","p","entry","networkProjection","filename","text","yaml","e","err","msg","w","d","g","x","maplibregl","extent","lnglat","mFac","padding","metric","widthExpression","mapCamera","routeID","projection","event","props","xmlWorker","message","resolve","reject","id","roads","transit","results","worker","GzipWorker","csvData","Papa","crossfilter","linkPassengersById","group","link","capacity","transitLink","TransitSupplyWorker","buffer","routeData","stopFacilities","transitLines","mapExtent","transitLine","route","linkID","geodata","content","label","geojson","coordinates","departures","ratio","colorBin","isRail","line","_colorScale","b","metersToTheRight","turf.lineOffset","mapBearing","stop","coord","point1","turf.point","point2","turf.bearing","xy","marker","source","routeIDs","routes","allLinks","sum","layerID","delta","i","NewXmlFetcher","colormap"],"mappings":"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"}